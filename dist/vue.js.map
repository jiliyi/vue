{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observer/array.js","../src/observer/index.js","../src/initState.js","../src/compile/index.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isFunction(val){\r\n    return typeof val == 'function';\r\n}\r\nexport function isObject(val){\r\n    return typeof val == 'object' && val != 'null'\r\n}","const oldArrayProto = Array.prototype;\r\nconst Methods = ['splice', 'push', 'pop', 'shift', 'unshift', 'sort', 'reverse'];\r\nconst arrayMethods = Object.create(oldArrayProto)\r\n\r\narrayMethods.__proto__ = Array.prototype;\r\n\r\nMethods.forEach(method => {\r\n    arrayMethods[method] = function (...args) {\r\n        const ob = this.__ob__.observeArray;\r\n        oldArrayProto[method].call(this, ...args);\r\n        let addItem = null;\r\n        switch (method) {\r\n            case 'push':\r\n                addItem = args;\r\n                break;\r\n            case 'unshift':\r\n                addItem = args;\r\n                break;\r\n            case 'splice':\r\n                addItem = args.slice(2);\r\n                break;\r\n        }\r\n         ob(addItem)\r\n    }\r\n})\r\n\r\n\r\n\r\nexport default arrayMethods","import { isObject } from \"../utils\";\r\n\r\nimport arrayMethods from './array'\r\n\r\n\r\n\r\nclass Observer{\r\n    constructor(data){\r\n        if(Array.isArray(data)){\r\n            //对数组进行劫持;\r\n            data.__proto__ = arrayMethods;\r\n            data.__ob__ = this;\r\n           this.observeArray(data);\r\n        }else{\r\n            this.walk(data);\r\n        }\r\n    }\r\n    walk(data){\r\n        Object.keys(data).forEach(key=>{\r\n            defineReactive(data,key,data[key])\r\n        })\r\n    }\r\n    observeArray(data){\r\n        data.forEach(item=>{\r\n            observe(item)\r\n        })\r\n    }\r\n   \r\n}\r\n\r\n\r\nfunction defineReactive(obj,key,val){\r\n    observe(val);\r\n    Object.defineProperty(obj,key,{\r\n        get(){\r\n            \r\n            return val\r\n        },\r\n        set(newV){\r\n            observe(newV)\r\n            val = newV;\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data){\r\n    //传入的不是对象，不监测\r\n    if(!isObject(data)) return\r\n    \r\n    new Observer(data);\r\n}","import { isFunction } from \"./utils\";\r\nimport { observe } from './observer/index'\r\n//初始化状态\r\nexport default function initState(vm){\r\n    let options = vm.$options;\r\n    \r\n    if(options.data){\r\n        //初始化data\r\n        initData(vm);\r\n    }\r\n    \r\n    if(options.methods){\r\n        //初始化methods\r\n    }\r\n    if(options.props){\r\n        //初始化props\r\n    }\r\n    if(options.computed){\r\n        //初始化computed\r\n    }\r\n    if(options.watch){\r\n        //初始化watch\r\n    }\r\n\r\n}\r\n\r\nfunction proxy(vm,source,key){\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[source][key];\r\n        },\r\n        set(newVal){\r\n            vm[source][key] = newVal;\r\n        }\r\n    })    \r\n}\r\n\r\nfunction initData(vm){\r\n    let options = vm.$options;\r\n    let data = options.data;\r\n    data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n    \r\n    for(let key in data){\r\n        //代理，可通过实例直接取数据\r\n        proxy(vm,'_data',key)\r\n    }\r\n    \r\n    observe(data);\r\n}","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 标签名 \r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //  用来获取的标签名的 match后的索引为1的\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 匹配开始标签的 \r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配闭合标签的\r\n//           aa  =   \"  xxx \"  | '  xxxx '  | xxx\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // a=b  a=\"b\"  a='b'\r\nconst startTagClose = /^\\s*(\\/?)>/; //     />   <div/>\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // {{aaaaa}}\r\n\r\n//  <div id=\"app\">{{ msg }}</div>\r\n\r\n/**\r\n * 处理开始标签的token\r\n * @param {*} tagName \r\n * @param {*} attributes \r\n */\r\nfunction start(tagName, attributes) {\r\n    console.log('开始标签', tagName, attributes)\r\n}\r\n\r\nfunction char(text) {\r\n    console.log('文本', text)\r\n}\r\n\r\nfunction end(tagName) { // 处理结束标签\r\n    console.log('结束标签', tagName)\r\n}\r\n\r\nfunction parserHTML(html) {\r\n\r\n    function advance(len) {\r\n        html = html.substring(len);\r\n    }\r\n\r\n    function parseStartTag() {\r\n        const start = html.match(startTagOpen);\r\n        if (start) {\r\n            const match = {\r\n                tagName: start[1],\r\n                attributes: []\r\n            }\r\n            //删除匹配成功的部分\r\n            advance(start[0].length);\r\n\r\n            //下一步，匹配属性\r\n            let end, attr;\r\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n\r\n                match.attributes.push({\r\n                    name: attr[1],\r\n                    value: attr[3] || attr[4] || attr[5]\r\n                })\r\n                advance(attr[0].length);\r\n            }\r\n            advance(end[0].length); //删除开始标签的 >\r\n            return match;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n\r\n\r\n\r\n    while (html) {//有html继续解析\r\n\r\n        let textEnd = html.indexOf('<');\r\n        if (textEnd === 0) {//step one 开始标签\r\n            let startTagMatch = parseStartTag()\r\n            if (startTagMatch) {\r\n                start(startTagMatch.tagName, startTagMatch.attributes)\r\n\r\n            }\r\n\r\n\r\n\r\n            let endTagMatch = html.match(endTag); // step three 结束标签\r\n            if (endTagMatch) {\r\n                end(endTagMatch[1])\r\n                advance(endTagMatch[0].length);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n        let text;\r\n        if (textEnd > 0) {\r\n            text = html.substring(0, textEnd);\r\n        }\r\n        if (text) {\r\n            advance(text.length)\r\n            char(text)\r\n        }\r\n\r\n    }\r\n}\r\n\r\n\r\nexport default function (template) {\r\n    parserHTML(template)\r\n}","import initState from './initState.js';\r\nimport compileToFunction from './compile/index.js';\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options){\r\n        let vm = this;\r\n        vm.$el = options.el;\r\n        vm.$options = options;\r\n        initState(vm)\r\n\r\n        if(options.el){\r\n            this.$mount(options.el)\r\n        }\r\n    }\r\n    Vue.prototype.$mount = function(el){\r\n        el = document.querySelector(el)\r\n        const vm = this;\r\n        const options = vm.$options;\r\n        if(!options.render){\r\n            //用户没传render\r\n            let template = options.template;\r\n            if(!template && el){\r\n                template = el.outerHTML;\r\n            }\r\n            let render = compileToFunction(template);\r\n            vm.render = render;\r\n        }\r\n    }\r\n}","import { initMixin } from \"./init.js\";\r\n\r\nfunction Vue(options){\r\n    this._init(options);\r\n}\r\n\r\n\r\ninitMixin(Vue)\r\n\r\nexport default  Vue;"],"names":["isFunction","val","isObject","oldArrayProto","Array","prototype","Methods","arrayMethods","Object","create","__proto__","forEach","method","ob","__ob__","observeArray","args","call","addItem","slice","Observer","data","isArray","walk","keys","key","defineReactive","item","observe","obj","defineProperty","get","set","newV","initState","vm","options","$options","initData","methods","props","computed","watch","proxy","source","newVal","_data","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","start","tagName","attributes","console","log","char","text","end","parserHTML","html","advance","len","substring","parseStartTag","match","length","attr","push","name","value","textEnd","indexOf","startTagMatch","endTagMatch","template","initMixin","Vue","_init","$el","el","$mount","document","querySelector","render","outerHTML","compileToFunction"],"mappings":"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"}